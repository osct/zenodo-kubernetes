apiVersion: v1
kind: ConfigMap
metadata:
  name: zenodo-config
data:
  invenio.cfg: |
    from invenio_github.config import GITHUB_REMOTE_APP
    #Global configurations
    APP_ALLOWED_HOSTS = ["your.open.access.repository.domain"]
    #Endpoint configurations
    ACCOUNTS_SESSION_REDIS_URL = "redis://zenodo-redis:6379/2"
    BROKER_URL = "amqp://USER:PASSWORD@zenodo-mq:5672//"
    CELERY_BROKER_URL = "amqp://USER:PASSWORD@zenodo-mq:5672//"
    QUEUES_BROKER_URL = "amqp://USER:PASSWORD@zenodo-mq:5672//"
    CACHE_REDIS_URL = "redis://zenodo-redis:6379/0"
    CACHE_TYPE = "redis"
    CELERY_RESULT_BACKEND = "redis://zenodo-redis:6379/1"
    SEARCH_ELASTIC_HOSTS = "[zenodo-es]"
    SECRET_KEY = "PASSWORD"
    SESSION_COOKIE_SECURE = "True"
    SQLALCHEMY_DATABASE_URI = "postgresql://USER:PASSWORD@zenodo-postgres/zenodo"
    REDIS_URL = "postgresql://USER:PASSWORD@zenodo-postgres/zenodo"
    #Communities configurations
    ZENODO_COMMUNITIES_NOTIFY_DISABLED = []
    ZENODO_COMMUNITIES_AUTO_ENABLED = True
    ZENODO_COMMUNITIES_AUTO_REQUEST = ['infn']
    ZENODO_COMMUNITIES_REQUEST_IF_GRANTS = []
    ZENODO_COMMUNITIES_ADD_IF_GRANTS = []
    ZENODO_FRONTPAGE_COMMUNITY = 'infn'
    COMMUNITIES_NEW_TEMPLATE = 'zenodo_communities/new.html'
    COMMUNITIES_EDIT_TEMPLATE = 'zenodo_communities/new.html'
    COMMUNITIES_INDEX_TEMPLATE = 'zenodo_communities/index.html'
    #Theme configurations
    THEME_SITENAME = "YOUR Open Access Repository"
    THEME_SITEURL = "https://your.open.access.repository.domain"
    THEME_TWITTERHANDLE = ""
    THEME_LOGO = "img/yourlogo.png"
    THEME_GOOGLE_ANALYTICS_ID = "YOURGOOGLEID"
    THEME_DOI_EXAMPLE = '10.your.doi/your.doi.suffix/21260'
    ZENODO_RECORDS_UI_LINKS_FORMAT = "https://your.open.access.repository.domain/record/{recid}"
    #Account configurations
    SECURITY_CHANGEABLE = False
    SECURITY_RECOVERABLE = False
    SECURITY_REGISTERABLE = False
    SECURITY_LOGIN_WITHOUT_CONFIRMATION = False
    SECURITY_EMAIL_SENDER = "librarian@your.open.access.repository"
    SECURITY_EMAIL_SUBJECT_REGISTER = "Welcome to %s!"%THEME_SITENAME
    #Mail configurations
    MAIL_SERVER = "SERVER"
    MAIL_PORT = PORT
    MAIL_USE_SSL = True
    MAIL_USE_TSL = False
    MAIL_USERNAME = "USER"
    MAIL_PASSWORD = "PASSWORD"
    MAIL_SUPPRESS_SEND = False
    ZENODO_ADMIN_EMAIL = "librarian@oyour.open.access.repository.domain"
    COMMUNITIES_REQUEST_EMAIL_SENDER = "librarian@your.open.access.repository.domain"
    #DataCite configurations
    ZENODO_LOCAL_DOI_PREFIXES = ["10.your.doi"]
    PIDSTORE_DATACITE_URL = "https://mds.datacite.org"
    PIDSTORE_DATACITE_TESTMODE = False
    PIDSTORE_DATACITE_DOI_PREFIX = "10.your.doi"
    PIDSTORE_DATACITE_DOI_SUFFIX = "your.doi.suffix"
    PIDSTORE_DATACITE_USERNAME = "USER"
    PIDSTORE_DATACITE_PASSWORD = "PASSWORD"
    DATACITE_UPDATING_RATE_PER_HOUR = 1000
    DATACITE_MAX_DESCRIPTION_SIZE = 20000
    DEPOSIT_DATACITE_MINTING_ENABLED = True
    #GitHub configurations
    GITHUB_WEBHOOK_RECEIVER_URL = 'https://your.open.access.repository.domain/api/hooks/receivers/github/events/?access_token={token}'
    SIPSTORE_BAGIT_TAGS = [
        ('Source-Organization', 'Your organisation name'),
        ('Organization-Address', 'Your organisation address'),
        ('Bagging-Date', None),  # Autogenerated
        ('Payload-Oxum', None),  # Autogenerated
        ('External-Identifier', None),  # Autogenerated
        ('External-Description', ("Your site description.")),
    ]
    SIPSTORE_ARCHIVER_WRITING_ENABLED = True
    GITHUB_REMOTE_APP.update(dict(
        description='Software collaboration platform, with one-click '
                    'software preservation in YOUR WEBSITE NAME.',
    ))
    GITHUB_REMOTE_APP['params']['request_token_params']['scope'] = 'user:email,admin:repo_hook,read:org'
    GITHUB_APP_CREDENTIALS = dict(
        consumer_key="YOUR-KEY",
        consumer_secret="YOUR-SECRET",
    )
    #ORCID configurations
    ORCID_APP_CREDENTIALS = dict(
        consumer_key="YOUR-KEY",
        consumer_secret="YOUR-SECRET",
    )
    #Stats configurations
    ZENODO_STATS_PIWIK_EXPORT_ENABLED = False
    #OAI configurations
    OAISERVER_ADMIN_EMAILS = ["librarian@your.open.access.repository.domain"]
    #Redirect configurations
    REDIRECTOR_EXTERNAL_REDIRECTS = [
        ['/dev', 'dev', 'http://developers.zenodo.org'],
        ['/faq', 'faq', 'http://help.zenodo.org'],
        ['/features', 'features', 'http://help.zenodo.org/features/'],
        ['/whatsnew', 'whatsnew', 'http://help.zenodo.org/whatsnew/'],
        ['/about', 'about', '/help/about'],
        ['/contact', 'contact', '/help/contact/'],
        ['/policies', 'policies', '/help/policies/'],
        ['/privacy-policy', 'privacy-policy',
         '/help/privacy-policy/'],
        ['/terms', 'terms', '/help/terms-of-use/'],
        ['/donate', 'donate', 'https://giving.web.cern.ch/civicrm/contribute/'
                              'transact%3Freset%3D1%26id%3D20'],
    ]
    #Support configurations
    SUPPORT_EMAIL = "librarian@your.open.access.repository.domain"
    SUPPORT_SUPPORT_EMAIL = ["librarian@your.open.access.repository.domain"]
    SUPPORT_SENDER_EMAIL = "librarian@your.open.access.repository.domain"
    SUPPORT_SENDER_NAME = "YOUR Open Access Repository"
    SUPPORT_EMAIL_CONFIRM_TITLE = "YOUR OAR Support"
    SUPPORT_EMAIL_CONFIRM_BODY = """Thank you for contacting YOUR OAR support.

    We have received your message, and we will do our best to get back to you as \
    soon as possible.
    This is an automated confirmation of your request, please do not reply to this\
    email.

    YOUR OAR Support
    https://your.open.access.repository.domain
    """
    SUPPORT_ISSUE_CATEGORIES = [
    {
        'key': 'file-modification',
        'title': 'File modification',
        'description': (
            'All requests related to updating files in already published '
            'record(s). This includes new file addition, file removal or '
            'file replacement. '
            'Before sending a request, please consider creating a '
            '<a href="http://help.zenodo.org/#versioning">new version</a> '
            'of your upload. Please first consult our '
            '<a href="http://help.zenodo.org/#general">FAQ</a> to get familiar'
            ' with the file update conditions, to see if your case is '
            'eligible.<br /><br />'
            'You request has to contain <u>all</u> of the points below:'
            '<ol>'
            '<li>Provide a justification for the file change in the '
            'description.</li>'
            '<li>Mention any use of the record(s) DOI in publications or '
            'online, e.g.: list papers that cite your record and '
            'provide links to posts on blogs and social media. '
            'Otherwise, state that to the best of your knowledge the DOI has '
            'not been used anywhere.</li>'
            '<li>Specify the record(s) you want to update <u>by the YOUR Open Access Repository'
            ' URL</u>, e.g.: "https://your.open.access.repository.domain.it/record/8428".<br />'
            "<u>Providing only the record's title, publication date or a "
            "screenshot with search result is not explicit enough</u>.</li>"
            '<li>If you want to delete or update a file, specify it '
            '<u>by its filename</u>, and mention if you want the name to '
            'remain as is or changed (by default the filename of the new '
            'file will be used).</li>'
            '<li>Upload the new files below or provide a publicly-accessible '
            'URL(s) with the files in the description.</li>'
            '</ol>'
            '<b><u>Not providing full information on any of the points above '
            'will significantly slow down your request resolution</u></b>, '
            'since our support staff will have to reply back with a request '
            'for missing information.'
        ),
        'recipients': ['your.open.access.repository.domain'],
    },
    {
        'key': 'upload-quota',
        'title': 'File upload quota increase',
        'description': (
            'All requests for a quota increase beyond the 50GB limit. '
            'Please include the following information with your request:'
            '<ol>'
            '<li>The total size of your dataset, number of files and the '
            'largest file in the dataset. When referring to file sizes'
            ' use <a href="https://en.wikipedia.org/wiki/IEEE_1541-2002">'
            'SI units</a></li>'
            '<li>Information related to the organization, project or grant '
            'which was involved in the research, which produced the '
            'dataset.</li>'
            '<li>Information on the currently in-review or future papers that '
            'will cite this dataset (if applicable). If possible specify the '
            'journal or conference.</li>'
            '</ol>'
        ),
        'recipients': ['librarian@your.open.access.repository.domain'],
    },
    {
        'key': 'record-inactivation',
        'title': 'Record inactivation',
        'description': (
            'Requests related to record inactivation, either by the record '
            'owner or a third party. Please specify the record(s) in question '
            'by the URL(s), and reason for the inactivation.'
        ),
        'recipients': ['librarian@your.open.access.repository.domain'],
    },
    {
        'key': 'partnership',
        'title': 'Partnership, outreach and media',
        'description': (
            'All questions related to possible partnerships, outreach, '
            'invited talks and other official inquiries by media.'
            'If you are a journal, organization or conference organizer '
            'interested in using INFN Open Access Repository as archive for your papers, software '
            'or data, please provide details for your usecase.'
            ),
        'recipients': ['librarian@your.open.access.repository.domain'],
    },
    {
        'key': 'tech-support',
        'title': 'Security issue, bug or spam report',
        'description': (
            'Report a technical issue or a spam content on INFN Open Access Repository.'
            'Please provide details on how to reproduce the bug. '
            'Upload any screenshots or files which are relevant to the issue '
            'or to means of reproducing it. Include error messages and '
            'error codes you might be getting in the description.<br /> '
            'For REST API errors, provide a minimal code which produces the '
            'issues. Use external services for scripts and long text'
            ', e.g.: <a href="https://gist.github.com/">GitHub Gist</a>. '
            '<strong>Do not disclose your password or REST API access tokens.'
            '</strong>'
            ),
        'recipients': ['librarian@your.open.access.repository.domain'],
    },
    {
        'key': 'other',
        'title': 'Other',
        'description': (
            'Questions which do not fit into any other category.'),
        'recipients': ['librarian@your.open.access.repository.domain'],
    }] 
---
apiVersion: v1
kind: Secret
metadata:
  name: zenodo-secrets
type: Opaque
stringData:
  username: USER
  password: PASSWORD
  flower_broker: amqp://USER:PASSWORD@zenodo-mq:5672//
  flower_broker_api: http://USER:PASSWORD@zenodo-mq:15672/api/
